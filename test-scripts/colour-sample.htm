<!DOCTYPE html>
<html>
<head>
<title>Peckham Sentiment</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
<meta name="viewport" content="width = device-width, initial-scale = 1.0 ,  minimum-scale = 1.0,  maximum-scale=1.0">

<link href="base.css" type="text/css" rel="stylesheet"/>
</head>
<body>


<script type="text/javascript" src="colour-theif.js"></script>
<script type="text/javascript">

// create canvas
var canvas; 

// canvas context
var context;

// size of body
var body_size = {};

// colour theif
var colour_thief;

var images = [
	
	{
		"x" : 800,
		"y" : 120,
		"asset" : "../samples/franks.jpg",
		"inner_radius" : 5,
		"outer_radius" : 120,
		"radius" : 90
	},
	{
		"x" : 100,
		"y" : 100,
		"asset" : "../samples/bar-story.jpg",
		"inner_radius" : 5,
		"outer_radius" : 70,
		"radius" : 60
	}
];

var sentiments = new Array();

// start
document.addEventListener("DOMContentLoaded", function() {
      
    // Add and get the canvas context
	canvas = document.createElement("canvas");
	document.body.appendChild(canvas);
	context = canvas.getContext('2d');
	
	// boom!
	sizing();
	
	//init color theif
	colour_thief = new ColorThief();
	
	// Load in an image and sample it
	for(var a = 0, length = images.length; a<length; a++) {
		
		var image = new Image();
		var data = images[a];

		// check that everything is loaded then render them out
		image.addEventListener("load", function(evt){
			if(a>=length) draw();	
		});
		
		image.setAttribute("src",data.asset);
		
		// create the circle
		var sentiment = new create_gradient(data.x,data.y,data.inner_radius, data.outer_radius, data.radius, image);			sentiments.push(sentiment);	
	}
	
});

// draws out all the circles
function draw() {
   
    context.clearRect(0, 0, body_size.width, body_size.height);
    for (var i = 0; i < sentiments.length; i++) {
        var rendered_circle = sentiments[i];
        rendered_circle.update();
    }
}

var create_gradient = function(x,y,inner_radius, outer_radius, radius, asset) {
	
	var self = this; 
	
	self.x = x,
	self.y = y,
	self.inner_radius = inner_radius,
	self.outer_radius = outer_radius,
	self.radius = radius, 
	self.asset = asset;
	
	self.update = function(){
		
		
		var colour_palette = colour_thief.getPalette(self.asset);
			
		// Create gradients
		var gradient = context.createRadialGradient(self.x, self.y, self.inner_radius, self.x, self.y, self.outer_radius);
		 
		for(var a = 0, length = colour_palette.length;  a < 3; a++) {
			var step = parseFloat(a*0.1).toFixed(1);
			if(a===0) step = 0;
			//gradient.addColorStop(step, 'rgb('+colour_palette[a].toString()+')');
			gradient.addColorStop(a*0.3, 'rgb('+colour_palette[a].toString()+')');
		}
		 
		gradient.addColorStop(1, 'rgba(0,0,0,0)');
		
		context.arc(self.x, self.y, self.radius, 0, 2 * Math.PI);
	
		// draw shapes
		context.fillStyle = gradient;
		context.fill();

	}
	
	return self;
}

function sizing() {
	body_size = document.body.getBoundingClientRect();
	canvas.width = body_size.width;
	canvas.height = body_size.height;	
}


 
	


</script>

</body>
</html>